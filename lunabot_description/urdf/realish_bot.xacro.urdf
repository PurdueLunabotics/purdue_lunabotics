<?xml version="1.0" ?>
<robot name="dummy_bot" xmlns:xacro="http://www.ros.org/wiki/xacro">

<xacro:property name="PI" value="3.1415926535897931"/>

<xacro:property name="chassisHeight" value="0.1"/>
<xacro:property name="chassisLength" value="0.9"/>
<xacro:property name="chassisWidth" value="0.5"/>
<xacro:property name="chassisMass" value="50.0"/>

<xacro:property name="wheelWidth" value="0.125"/>
<xacro:property name="wheelRadius" value="0.2"/>
<xacro:property name="wheelMass" value="5.0"/>

<xacro:macro name="box_inertia" params="m x y z">
  <inertia  ixx="${m*(y*y+z*z)/12}" ixy = "0" ixz = "0"
    iyy="${m*(x*x+z*z)/12}" iyz = "0"
    izz="${m*(x*x+z*z)/12}"
  />
</xacro:macro>

<xacro:macro name="cylinder_inertia" params="m r h">
  <inertia  ixx="${m*(3*r*r+h*h)/12}" ixy = "0" ixz = "0"
    iyy="${m*(3*r*r+h*h)/12}" iyz = "0"
    izz="${m*r*r/2}"
  />
</xacro:macro>

<!-- NOTE: STL files don't work in gazebo with binary encoding, try ASCII instead -->

<xacro:include filename="$(find lunabot_description)/urdf/materials.xacro" />
<!-- <xacro:include filename="$(find lunabot_description)/urdf/dummy_bot.trans" /> -->
<!-- <xacro:include filename="$(find lunabot_description)/urdf/dummy_bot.gazebo" /> -->
<link name="base_link">
  <inertial>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <mass value="${chassisMass}"/>
    <xacro:box_inertia m="${chassisMass}" x="${chassisLength}" y="${chassisWidth}" z="${chassisHeight}"/>
  </inertial>
  <visual>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <!-- <mesh filename="package://lunabot_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/> -->
      <mesh>
        <uri>model://realistic_robot/realistic_robot.stl</uri>
        <scale>1 1 1</scale>
      </mesh>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <!-- <mesh filename="package://lunabot_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/> -->
      <mesh>
        <uri>model://realistic_robot/realistic_robot.stl</uri>
        <scale>1 1 1</scale>
      </mesh>
    </geometry>
  </collision>
</link>

<!-- wheel macro -->
<xacro:macro name="wheel" params="name x y">
  <link name="${name}">
    <inertial>
      <origin xyz="0 0 0"/>
      <mass value="${wheelMass}"/>
      <xacro:cylinder_inertia m="${wheelMass}" r="${wheelRadius}" h="${wheelWidth}"/>
    </inertial>
    <visual>
      <origin rpy="1.5708 0 0" xyz="0 0 0"/>
      <!-- <geometry><cylinder radius="${wheelRadius}" length="${wheelWidth}"/></geometry> -->
      <material name="silver"/>
    </visual>
    <collision>
      <origin rpy="1.5708 0 0" xyz="0 0 0"/>
      <geometry><cylinder radius="${wheelRadius}" length="${wheelWidth}"/></geometry>
    </collision>
  </link>

  <joint name="${name}_rev" type="continuous">
    <origin rpy="0 0 0" xyz="${x} ${y} 0"/>
    <parent link="base_link"/>
    <child link="${name}"/>
    <axis xyz="0 1 0"/>
    <limit effort="10.0" velocity="100.0"/>
  </joint>
</xacro:macro>

<!-- Instantiate wheels -->
<xacro:wheel name="left_front"  x="0.25" y="0.32"/>
<xacro:wheel name="left_back"   x="-0.25" y="0.32"/>
<xacro:wheel name="right_front" x="0.25" y="-0.32"/>
<xacro:wheel name="right_back"  x="-0.25" y="-0.32"/>

<!-- <xacro:include filename="package://mining_arena_gazebo/realsense_ros_gazebo/xacro/depthcam.xacro"/> -->
<!-- <xacro:realsense_d435 sensor_name="d435_forward" parent_link="base_link" rate="10"> -->
  <!-- <origin xyz="0.000 0.229 0.482" rpy="0 0 0" /> -->
<!-- </xacro:realsense_d435> -->
<!-- <xacro:realsense_d435 sensor_name="d435_backward" parent_link="base_link" rate="10"> -->
  <!-- <origin xyz="0.000 0.20 0.482" rpy="0 0 3.1415" /> -->
<!-- </xacro:realsense_d435> -->

<!-- Based on Intel realsense D435 (intrinsics and distortion not modeled)-->
<sensor name="rs_front" type="rgbd_camera">
  <pose>0.122 0 0.257 0 0.46 0</pose>
  <always_on>1</always_on>
  <update_rate>30</update_rate>
  <camera name="rs_front">
    <horizontal_fov>1.50098</horizontal_fov>
    <lens>
      <intrinsics>
        <!-- fx = fy = width / ( 2 * tan (hfov / 2 ) ) -->
        <fx>343.159</fx>
        <fy>343.159</fy>
        <!-- cx = ( width - 1 ) / 2 -->
        <cx>319.5</cx>
        <!-- cy = ( height - 1 ) / 2 -->
        <cy>179.5</cy>
        <s>0</s>
      </intrinsics>
    </lens>
    <distortion>
      <k1>0.0</k1>
      <k2>0.0</k2>
      <k3>0.0</k3>
      <p1>0.0</p1>
      <p2>0.0</p2>
      <center>0.5 0.5</center>
    </distortion>
    <image>
      <width>640</width>
      <height>360</height>
      <format>R8G8B8</format>
    </image>
    <clip>
      <near>0.01</near>
      <far>300</far>
    </clip>
    <depth_camera>
      <clip>
        <near>0.1</near>
        <far>10</far>
      </clip>
    </depth_camera>
    <noise>
      <type>gaussian</type>
      <mean>0</mean>
      <stddev>0.007</stddev>
    </noise>
  </camera>
</sensor>

<ros2_control name="GazeboSystem" type="system">
  <hardware>
    <plugin>gz_ros2_control/GazeboSimSystem</plugin>
  </hardware>
  <joint name="right_front_rev">
    <command_interface name="velocity"/>
    <state_interface name="position"/>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>
  </joint>
  <joint name="left_front_rev">
    <command_interface name="velocity"/>
    <state_interface name="position"/>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>
  </joint>
  <joint name="right_back_rev">
    <command_interface name="velocity"/>
    <state_interface name="position"/>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>
  </joint>
  <joint name="left_back_rev">
    <command_interface name="velocity"/>
    <state_interface name="position"/>
    <state_interface name="velocity"/>
    <state_interface name="effort"/>
  </joint>
</ros2_control>

<!-- Transmissions -->
<!-- <xacro:macro name="transmission" params="joint_name"> -->
  <!-- <transmission name="${joint_name}_trans"> -->
    <!-- <type>transmission_interface/SimpleTransmission</type> -->
    <!-- <joint name="${joint_name}"> -->
      <!-- <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface> -->
    <!-- </joint> -->
    <!-- <actuator name="${joint_name}_motor"> -->
      <!-- <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface> -->
      <!-- <mechanicalReduction>1.0</mechanicalReduction> -->
    <!-- </actuator> -->
  <!-- </transmission> -->
<!-- </xacro:macro> -->

<!-- <xacro:transmission joint_name="left_front_rev"/> -->
<!-- <xacro:transmission joint_name="left_back_rev"/> -->
<!-- <xacro:transmission joint_name="right_front_rev"/> -->
<!-- <xacro:transmission joint_name="right_back_rev"/> -->

<!-- friction -->
<!-- <xacro:macro name="wheel_friction" params="name"> -->
  <!-- <gazebo reference="${name}"> -->
    <!-- <mu1>1.0</mu1> -->
    <!-- <mu2>1.0</mu2> -->
    <!-- <joint><provideFeedback>true</provideFeedback></joint> -->
  <!-- </gazebo> -->
<!-- </xacro:macro> -->

<!-- <xacro:wheel_friction name="left_front"/> -->
<!-- <xacro:wheel_friction name="left_back"/> -->
<!-- <xacro:wheel_friction name="right_front"/> -->
<!-- <xacro:wheel_friction name="right_back"/> -->

<gazebo>
  <plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
    <left_joint>left_front_rev</left_joint>
    <left_joint>left_back_rev</left_joint>
    <right_joint>right_front_rev</right_joint>
    <right_joint>right_back_rev</right_joint>

    <wheel_separation>0.64</wheel_separation>
    <wheel_radius>0.2</wheel_radius>

    <odom_publish_frequency>50.0</odom_publish_frequency>

    <topic>cmd_vel</topic>

    <odom_topic>odom</odom_topic>

    <frame_id>base_link</frame_id>

    <min_velocity>-1.0</min_velocity>
    <max_velocity>1.0</max_velocity>
    <min_acceleration>-1.0</min_acceleration>
    <max_acceleration>1.0</max_acceleration>
    <min_jerk>0.0</min_jerk>
    <max_jerk>0.0</max_jerk>

  </plugin>
</gazebo>

</robot>